sudo: false

language: php

php:
  - 5.5
  - 5.6

env:
  - SYMFONY_VERSION="2.3.*"
  - SYMFONY_VERSION="2.6.*"
  - SYMFONY_VERSION="2.7.*"
  - SYMFONY_VERSION="2.8.0-dev"
  - SYMFONY_VERSION="dev-master"

matrix:
  allow_failures:
    - env: SYMFONY_VERSION="2.8.0-dev"
    - env: SYMFONY_VERSION="dev-master"
  fast_finish: true

cache:
  directories:
    - vendor
    - $HOME/.composer/cache

before_install:
  - composer selfupdate
  - composer config github-oauth.github.com $GITHUB_OAUTH_TOKEN
  - composer require --dev --no-update "symfony/http-kernel:${SYMFONY_VERSION}" "symfony/config:${SYMFONY_VERSION}" "symfony/dependency-injection:${SYMFONY_VERSION}"

install:
  - composer install --no-interaction --prefer-dist

script:
  - phpunit
  - mkdir -p .autoload/composer && mv -v ./vendor/autoload.php ./.autoload/autoload.php && mv -v ./vendor/composer/!(installed.json) ./.autoload/composer

after_script:
  - mv -v ./.autoload/autoload.php ./vendor/autoload.php && mv -v ./.autoload/composer/* ./vendor/composer && rm -r .autoload
  - php vendor/bin/coveralls -v
